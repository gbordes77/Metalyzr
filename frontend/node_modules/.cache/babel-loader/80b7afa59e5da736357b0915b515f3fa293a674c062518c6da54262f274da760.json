{"ast":null,"code":"import React,{useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import{useAdminStore}from'../../store/adminStore';import{useAPIData}from'../../hooks/useAPIData';import{LoadingSpinner}from'../../components/ui/LoadingSpinner';import{ErrorMessage}from'../../components/ui/ErrorMessage';import{Card}from'../../components/ui/Card';import{ErrorBoundary}from'../../components/ErrorBoundary';import{ArrowLeft,Database,Download,Play,Settings,TrendingUp,Users,Activity,RefreshCw}from'lucide-react';// Composants auxiliaires\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const StatCard=_ref=>{let{icon,label,value,loading,color='text-gray-900'}=_ref;return/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:icon}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm font-medium text-gray-600\",children:label}),/*#__PURE__*/_jsx(\"p\",{className:`text-2xl font-bold ${color}`,children:loading?/*#__PURE__*/_jsx(LoadingSpinner,{className:\"h-6 w-6\"}):value})]})]})});};const ActionCard=_ref2=>{let{title,subtitle,description,buttonText,buttonIcon,buttonClass,disabled,onClick}=_ref2;return/*#__PURE__*/_jsx(Card,{title:title,subtitle:subtitle,children:/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:description}),/*#__PURE__*/_jsxs(\"button\",{className:`w-full flex items-center justify-center px-4 py-2 rounded-lg font-medium transition-colors ${buttonClass} ${disabled?'opacity-50 cursor-not-allowed':''}`,disabled:disabled,onClick:onClick,children:[buttonIcon,buttonText]})]})});};const AdminDashboard=()=>{var _tournaments$data,_archetypes$data;const navigate=useNavigate();const{stats,status,setStats,setStatus,updateLastUpdate,addError}=useAdminStore();// Fetch stats avec le nouveau hook\nconst{data:statsData,loading:statsLoading,error:statsError,refetch:refetchStats}=useAPIData('/api/stats',{onSuccess:data=>{setStats(data);updateLastUpdate();},onError:error=>{setStatus('offline');addError(`Stats error: ${error.message}`);},showNotifications:false});// Fetch health status\nconst{data:healthData,loading:healthLoading,refetch:refetchHealth}=useAPIData('/health',{onSuccess:data=>{setStatus(data.status==='healthy'?'online':'degraded');},onError:()=>{setStatus('offline');},showNotifications:false});// Fetch tournaments\nconst{data:tournaments,loading:tournamentsLoading,error:tournamentsError,refetch:refetchTournaments}=useAPIData('/api/tournaments/',{showNotifications:false});// Fetch archetypes  \nconst{data:archetypes,loading:archetypesLoading,error:archetypesError,refetch:refetchArchetypes}=useAPIData('/api/archetypes/',{showNotifications:false});// Auto-refresh toutes les 30 secondes\nuseEffect(()=>{const interval=setInterval(()=>{refetchStats();refetchHealth();refetchTournaments();refetchArchetypes();},30000);return()=>clearInterval(interval);},[refetchStats,refetchHealth,refetchTournaments,refetchArchetypes]);const handleRefresh=useCallback(()=>{refetchStats();refetchHealth();refetchTournaments();refetchArchetypes();},[refetchStats,refetchHealth,refetchTournaments,refetchArchetypes]);const getStatusColor=()=>{switch(status){case'online':return'text-green-600';case'offline':return'text-red-600';case'degraded':return'text-yellow-600';default:return'text-gray-600';}};const getStatusText=()=>{switch(status){case'online':return'En ligne';case'offline':return'Hors ligne';case'degraded':return'Dégradé';default:return'Vérification...';}};const isLoading=statsLoading&&!stats.tournaments;const isRefreshing=statsLoading||healthLoading;if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsx(LoadingSpinner,{className:\"h-8 w-8\"})});}return/*#__PURE__*/_jsx(ErrorBoundary,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"min-h-screen bg-gray-50\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-white shadow-sm border-b\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container mx-auto px-4 py-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/'),className:\"flex items-center text-gray-600 hover:text-gray-900 mr-4\",children:[/*#__PURE__*/_jsx(ArrowLeft,{className:\"h-5 w-5 mr-1\"}),\"Retour au Dashboard\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-gray-900\",children:\"Administration\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-2\",children:\"Gestion et monitoring de Metalyzr\"})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleRefresh,disabled:isRefreshing,className:\"flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors\",children:[/*#__PURE__*/_jsx(RefreshCw,{className:`h-4 w-4 mr-2 ${isRefreshing?'animate-spin':''}`}),\"Actualiser\"]})]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container mx-auto px-4 py-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\",children:[/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Database,{className:\"h-8 w-8 text-blue-500\"}),label:\"Tournois\",value:stats.tournaments,loading:statsLoading}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(TrendingUp,{className:\"h-8 w-8 text-green-500\"}),label:\"Arch\\xE9types actifs\",value:stats.archetypes,loading:statsLoading}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Users,{className:\"h-8 w-8 text-purple-500\"}),label:\"Total decks\",value:stats.decks,loading:statsLoading}),/*#__PURE__*/_jsx(StatCard,{icon:/*#__PURE__*/_jsx(Activity,{className:\"h-8 w-8 text-orange-500\"}),label:\"Statut\",value:getStatusText(),loading:healthLoading,color:getStatusColor()})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8\",children:[/*#__PURE__*/_jsx(ActionCard,{title:\"Scraping de Donn\\xE9es\",subtitle:\"Lancer le scraping des tournois\",description:\"Collecter les derni\\xE8res donn\\xE9es de tournois depuis MTGTop8\",buttonText:\"Lancer le Scraping\",buttonIcon:/*#__PURE__*/_jsx(Play,{className:\"h-4 w-4 mr-2\"}),buttonClass:\"bg-green-600 text-white hover:bg-green-700\",disabled:status==='offline',onClick:()=>{console.log('Scraping lancé');// Votre logique de scraping ici\n}}),/*#__PURE__*/_jsx(ActionCard,{title:\"Export des Donn\\xE9es\",subtitle:\"T\\xE9l\\xE9charger les donn\\xE9es\",description:\"Exporter les donn\\xE9es de tournois et arch\\xE9types\",buttonText:\"Exporter CSV\",buttonIcon:/*#__PURE__*/_jsx(Download,{className:\"h-4 w-4 mr-2\"}),buttonClass:\"bg-blue-600 text-white hover:bg-blue-700\",disabled:stats.tournaments===0,onClick:()=>{console.log('Export CSV');// Votre logique d'export ici\n}}),/*#__PURE__*/_jsx(ActionCard,{title:\"Configuration\",subtitle:\"Param\\xE8tres syst\\xE8me\",description:\"Configurer les arch\\xE9types et r\\xE8gles de d\\xE9tection\",buttonText:\"Param\\xE8tres\",buttonIcon:/*#__PURE__*/_jsx(Settings,{className:\"h-4 w-4 mr-2\"}),buttonClass:\"bg-gray-600 text-white hover:bg-gray-700\",onClick:()=>{console.log('Configuration');// Votre logique de configuration ici\n}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-8\",children:[/*#__PURE__*/_jsx(Card,{title:\"Tournois R\\xE9cents\",subtitle:\"Derniers tournois ajout\\xE9s\",children:tournamentsError?/*#__PURE__*/_jsx(ErrorMessage,{message:tournamentsError.message,onRetry:refetchTournaments}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:tournamentsLoading?/*#__PURE__*/_jsx(LoadingSpinner,{className:\"h-8 w-8 mx-auto\"}):(tournaments===null||tournaments===void 0?void 0:(_tournaments$data=tournaments.data)===null||_tournaments$data===void 0?void 0:_tournaments$data.length)>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 max-h-64 overflow-y-auto\",children:tournaments.data.slice(0,5).map(tournament=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:tournament.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:tournament.format})]}),/*#__PURE__*/_jsx(\"span\",{className:\"text-sm text-gray-400\",children:tournament.date})]},tournament.id))}):/*#__PURE__*/_jsxs(_Fragment,{children:[\"Aucun tournoi r\\xE9cent\",/*#__PURE__*/_jsx(\"button\",{onClick:refetchTournaments,className:\"block mx-auto mt-2 text-blue-600 hover:text-blue-700\",children:\"R\\xE9essayer\"})]})})}),/*#__PURE__*/_jsx(Card,{title:\"Arch\\xE9types Populaires\",subtitle:\"Top arch\\xE9types par nombre de decks\",children:archetypesError?/*#__PURE__*/_jsx(ErrorMessage,{message:archetypesError.message,onRetry:refetchArchetypes}):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:archetypesLoading?/*#__PURE__*/_jsx(LoadingSpinner,{className:\"h-8 w-8 mx-auto\"}):(archetypes===null||archetypes===void 0?void 0:(_archetypes$data=archetypes.data)===null||_archetypes$data===void 0?void 0:_archetypes$data.length)>0?/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 max-h-64 overflow-y-auto\",children:archetypes.data.slice(0,5).map(archetype=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:archetype.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:archetype.description})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm text-gray-400\",children:[archetype.deck_count||0,\" decks\"]})]},archetype.id))}):/*#__PURE__*/_jsxs(_Fragment,{children:[\"Aucun arch\\xE9type populaire\",/*#__PURE__*/_jsx(\"button\",{onClick:refetchArchetypes,className:\"block mx-auto mt-2 text-blue-600 hover:text-blue-700\",children:\"R\\xE9essayer\"})]})})})]})]})]})});};export default AdminDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}