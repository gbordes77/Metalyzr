<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proc√©dure d'Autonomie - Metalyzr</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 40px;
            border-left: 4px solid #3498db;
            padding-left: 20px;
        }
        .section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
        }
        .section h3 {
            color: #34495e;
            font-size: 1.3em;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        .command {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        .command-title {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .command-desc {
            color: #666;
            margin-bottom: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .command-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
        }
        .step-number {
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        .danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #721c24;
        }
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        li {
            margin: 8px 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ Proc√©dure d'Autonomie</h1>
            <p>Guide complet pour d√©marrer et arr√™ter Metalyzr en autonomie</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>üéØ Vue d'ensemble</h2>
                <p>Ce guide vous permet d'√™tre totalement autonome pour g√©rer le serveur Metalyzr. Vous apprendrez √† d√©marrer, arr√™ter, red√©marrer et diagnostiquer l'application sans assistance technique.</p>
                
                <div class="success">
                    <strong>‚úÖ Objectif :</strong> √ätre 100% autonome sur la gestion du serveur Metalyzr en moins de 5 minutes.
                </div>
            </div>

            <div class="section">
                <h2>üìã Pr√©requis - V√©rification Rapide</h2>
                
                <div class="step">
                    <span class="step-number">‚úì</span>
                    <strong>V√©rifier Python 3.8+</strong>
                    <div class="command-example">python3 --version</div>
                </div>

                <div class="step">
                    <span class="step-number">‚úì</span>
                    <strong>V√©rifier Node.js 16+</strong>
                    <div class="command-example">node --version && npm --version</div>
                </div>

                <div class="step">
                    <span class="step-number">‚úì</span>
                    <strong>Emplacement du projet</strong>
                    <div class="command-example">cd /chemin/vers/Metalyzr</div>
                </div>
            </div>

            <div class="section">
                <h2>üöÄ D√©marrage Complet - Mode Express</h2>
                
                <h3>Option A : Script Automatique (Recommand√©)</h3>
                <div class="command">
                    <div class="command-title">./start-metalyzr.sh</div>
                    <div class="command-desc">Lance automatiquement backend + frontend</div>
                    <div class="command-example">
# Depuis la racine du projet
chmod +x start-metalyzr.sh
./start-metalyzr.sh
                    </div>
                </div>

                <h3>Option B : D√©marrage Manuel (Contr√¥le Total)</h3>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Backend API (Terminal 1)</strong>
                    <div class="command-example">
cd backend
source venv_simple/bin/activate  # Windows: venv_simple\Scripts\activate
uvicorn main_simple:app --host 0.0.0.0 --port 8000
                    </div>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>Frontend React (Terminal 2)</strong>
                    <div class="command-example">
cd frontend
npm run build
cd build
node serve-spa.js
                    </div>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>V√©rification</strong>
                    <div class="command-example">
# Backend : http://localhost:8000/health
# Frontend : http://localhost:3000
curl http://localhost:8000/health
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üõë Arr√™t Complet</h2>
                
                <h3>Method 1 : Arr√™t Propre</h3>
                <div class="command">
                    <div class="command-desc">Dans chaque terminal o√π les services tournent</div>
                    <div class="command-example">Ctrl + C</div>
                </div>

                <h3>Method 2 : Arr√™t Forc√© (Si Bloqu√©)</h3>
                <div class="command">
                    <div class="command-desc">Tuer tous les processus Metalyzr</div>
                    <div class="command-example">
# Tuer le backend
pkill -f "uvicorn.*main_simple"
pkill -f "python.*main_simple"

# Tuer le frontend  
pkill -f "node.*serve-spa"

# V√©rification
ps aux | grep -E "(uvicorn|main_simple|serve-spa)"
                    </div>
                </div>

                <h3>Method 3 : Arr√™t par Port (Dernier Recours)</h3>
                <div class="command">
                    <div class="command-desc">Si les ports restent occup√©s</div>
                    <div class="command-example">
# Lib√©rer port 8000 (backend)
sudo lsof -ti:8000 | xargs kill -9

# Lib√©rer port 3000 (frontend)
sudo lsof -ti:3000 | xargs kill -9
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîÑ Red√©marrage Intelligent</h2>
                
                <div class="step">
                    <span class="step-number">1</span>
                    <strong>Arr√™t propre</strong>
                    <div class="command-example">./stop-metalyzr.sh  # ou Ctrl+C dans les terminaux</div>
                </div>

                <div class="step">
                    <span class="step-number">2</span>
                    <strong>V√©rification de l'arr√™t</strong>
                    <div class="command-example">
ps aux | grep -E "(metalyzr|uvicorn|serve-spa)" | grep -v grep
# Doit √™tre vide
                    </div>
                </div>

                <div class="step">
                    <span class="step-number">3</span>
                    <strong>Red√©marrage</strong>
                    <div class="command-example">./start-metalyzr.sh</div>
                </div>

                <div class="step">
                    <span class="step-number">4</span>
                    <strong>Test de sant√©</strong>
                    <div class="command-example">curl http://localhost:8000/health/detailed</div>
                </div>
            </div>

            <div class="section">
                <h2>üîç Diagnostic Rapide</h2>
                
                <h3>V√©rifications Standards</h3>
                <div class="command">
                    <div class="command-title">Health Check Complet</div>
                    <div class="command-example">
# Sant√© basique
curl http://localhost:8000/health

# Diagnostic complet avec services externes
curl http://localhost:8000/health/detailed

# M√©triques syst√®me
curl http://localhost:8000/metrics
                    </div>
                </div>

                <div class="command">
                    <div class="command-title">Status des Processus</div>
                    <div class="command-example">
# V√©rifier les processus actifs
ps aux | grep -E "(uvicorn|main_simple|serve-spa|node)" | grep -v grep

# V√©rifier les ports occup√©s
lsof -i :8000  # Backend
lsof -i :3000  # Frontend
                    </div>
                </div>

                <div class="command">
                    <div class="command-title">Logs d'Erreur</div>
                    <div class="command-example">
# Logs backend
tail -f backend/metalyzr.log

# Logs syst√®me (si configur√©)
tail -f /var/log/metalyzr.log
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>‚ö†Ô∏è Probl√®mes Courants & Solutions</h2>
                
                <h3>‚ùå "Port already in use"</h3>
                <div class="warning">
                    <strong>Probl√®me :</strong> Les ports 8000 ou 3000 sont d√©j√† occup√©s<br>
                    <strong>Solution :</strong>
                    <div class="command-example">
sudo lsof -ti:8000 | xargs kill -9
sudo lsof -ti:3000 | xargs kill -9
./start-metalyzr.sh
                    </div>
                </div>

                <h3>‚ùå "Module not found"</h3>
                <div class="warning">
                    <strong>Probl√®me :</strong> D√©pendances Python manquantes<br>
                    <strong>Solution :</strong>
                    <div class="command-example">
cd backend
source venv_simple/bin/activate
pip install -r requirements_simple.txt
                    </div>
                </div>

                <h3>‚ùå "npm ERR!"</h3>
                <div class="warning">
                    <strong>Probl√®me :</strong> Erreur de build frontend<br>
                    <strong>Solution :</strong>
                    <div class="command-example">
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run build
                    </div>
                </div>

                <h3>‚ùå "Health check failed"</h3>
                <div class="warning">
                    <strong>Probl√®me :</strong> Services externes indisponibles<br>
                    <strong>Solution :</strong> Normal, l'app fonctionne en mode d√©grad√©
                    <div class="command-example">
curl http://localhost:8000/health  # Doit retourner "healthy"
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìä Scripts d'Automatisation</h2>
                
                <h3>Script de D√©marrage Personnalis√©</h3>
                <div class="command">
                    <div class="command-title">start-metalyzr-custom.sh</div>
                    <div class="command-example">
#!/bin/bash
echo "üöÄ D√©marrage Metalyzr..."

# Nettoyer les anciens processus
pkill -f "uvicorn.*main_simple" 2>/dev/null
pkill -f "node.*serve-spa" 2>/dev/null

# D√©marrer backend
cd backend
source venv_simple/bin/activate
nohup uvicorn main_simple:app --host 0.0.0.0 --port 8000 > ../logs/backend.log 2>&1 &
BACKEND_PID=$!

# Attendre le backend
sleep 5

# D√©marrer frontend
cd ../frontend/build
nohup node serve-spa.js > ../../logs/frontend.log 2>&1 &
FRONTEND_PID=$!

echo "‚úÖ Backend PID: $BACKEND_PID"
echo "‚úÖ Frontend PID: $FRONTEND_PID"
echo "üîó URLs:"
echo "   - Frontend: http://localhost:3000"
echo "   - Backend: http://localhost:8000"
echo "   - Health: http://localhost:8000/health"
                    </div>
                </div>

                <h3>Script d'Arr√™t Personnalis√©</h3>
                <div class="command">
                    <div class="command-title">stop-metalyzr-custom.sh</div>
                    <div class="command-example">
#!/bin/bash
echo "üõë Arr√™t Metalyzr..."

# Arr√™t propre
pkill -f "uvicorn.*main_simple"
pkill -f "node.*serve-spa"

# Attendre l'arr√™t
sleep 3

# V√©rification
REMAINING=$(ps aux | grep -E "(uvicorn.*main_simple|node.*serve-spa)" | grep -v grep | wc -l)

if [ $REMAINING -eq 0 ]; then
    echo "‚úÖ Metalyzr arr√™t√© avec succ√®s"
else
    echo "‚ö†Ô∏è Arr√™t forc√© n√©cessaire..."
    pkill -9 -f "uvicorn.*main_simple"
    pkill -9 -f "node.*serve-spa"
    echo "‚úÖ Arr√™t forc√© termin√©"
fi
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üéØ Checklist de Mise en Service</h2>
                
                <div class="step">
                    <strong>‚ñ° Pr√©requis v√©rifi√©s</strong> (Python 3.8+, Node.js 16+)
                </div>
                <div class="step">
                    <strong>‚ñ° Scripts ex√©cutables</strong> (chmod +x *.sh)
                </div>
                <div class="step">
                    <strong>‚ñ° D√©pendances install√©es</strong> (pip install + npm install)
                </div>
                <div class="step">
                    <strong>‚ñ° Ports libres</strong> (8000, 3000)
                </div>
                <div class="step">
                    <strong>‚ñ° Services d√©marr√©s</strong> (./start-metalyzr.sh)
                </div>
                <div class="step">
                    <strong>‚ñ° Health checks OK</strong> (curl localhost:8000/health)
                </div>
                <div class="step">
                    <strong>‚ñ° Frontend accessible</strong> (http://localhost:3000)
                </div>
                <div class="step">
                    <strong>‚ñ° Donn√©es charg√©es</strong> (curl localhost:8000/api/stats)
                </div>
            </div>

            <div class="success">
                <strong>üéâ F√©licitations !</strong><br>
                Vous √™tes maintenant totalement autonome pour g√©rer Metalyzr. Gardez ce guide sous la main pour les op√©rations courantes !
            </div>
        </div>
    </div>
</body>
</html> 