<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide Administrateur - Metalyzr</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 40px;
        }
        .section {
            margin-bottom: 40px;
            border-left: 4px solid #3498db;
            padding-left: 20px;
        }
        .section h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
        }
        .section h3 {
            color: #34495e;
            font-size: 1.3em;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        .command {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            font-family: 'Monaco', 'Consolas', monospace;
        }
        .command-title {
            font-weight: bold;
            color: #e74c3c;
            font-size: 1.1em;
            margin-bottom: 10px;
        }
        .command-desc {
            color: #666;
            margin-bottom: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .command-example {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }
        .step {
            background: #f8f9fa;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 10px 0;
        }
        .step-number {
            background: #28a745;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: bold;
        }
        .params {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        .param {
            margin: 5px 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        .required {
            color: #e74c3c;
            font-weight: bold;
        }
        .optional {
            color: #6c757d;
        }
        .config-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .config-title {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
        }
        .endpoint {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 10px 0;
        }
        .endpoint-method {
            font-weight: bold;
            color: #1976d2;
        }
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        li {
            margin: 8px 0;
        }
        code {
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }
        .badge-get { background: #d4edda; color: #155724; }
        .badge-post { background: #d1ecf1; color: #0c5460; }
        .badge-put { background: #fff3cd; color: #856404; }
        .badge-delete { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Guide Administrateur</h1>
            <p>Configuration compl√®te et administration avanc√©e de Metalyzr</p>
        </div>
        
        <div class="content">
            <div class="section">
                <h2>üéØ Vue d'ensemble</h2>
                <p>Ce guide couvre toutes les fonctionnalit√©s d'administration de Metalyzr, depuis la configuration initiale jusqu'√† la maintenance avanc√©e. Vous trouverez ici tous les endpoints API, param√®tres de configuration et outils d'administration.</p>
                
                <div class="success">
                    <strong>‚úÖ Objectif :</strong> Ma√Ætriser tous les aspects administratifs de Metalyzr pour une gestion optimale.
                </div>
            </div>

            <div class="section">
                <h2>üîß Configuration Syst√®me</h2>
                
                <h3>Variables d'Environnement</h3>
                <div class="config-section">
                    <div class="config-title">Fichier .env (backend/)</div>
                    <div class="command-example">
# Configuration Base de Donn√©es
DATABASE_URL=postgresql://user:pass@localhost/metalyzr
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your-service-key

# Configuration API
API_HOST=0.0.0.0
API_PORT=8000
DEBUG=false
ENVIRONMENT=production

# Configuration Cache
CACHE_TTL=3600
CACHE_SIZE=1000
REDIS_URL=redis://localhost:6379

# Configuration MTG APIs
MELEE_API_KEY=your-api-key
MTGTOP8_RATE_LIMIT=1.0
GITHUB_TOKEN=your-github-token

# Configuration Monitoring
PROMETHEUS_PORT=9090
GRAFANA_PORT=3001
LOG_LEVEL=INFO
                    </div>
                </div>

                <h3>Configuration Avanc√©e</h3>
                <div class="config-section">
                    <div class="config-title">backend/config.py</div>
                    <div class="command-example">
# Rate Limiting
RATE_LIMIT_REQUESTS = 100
RATE_LIMIT_WINDOW = 60  # seconds

# Health Check Timeouts
HEALTH_CHECK_TIMEOUT = 30
EXTERNAL_SERVICE_TIMEOUT = 5

# Scraping Configuration
SCRAPING_DELAY = 1.0
MAX_CONCURRENT_SCRAPES = 5
RETRY_ATTEMPTS = 3

# Archetype Classification
CONFIDENCE_THRESHOLD = 0.7
MIN_CARDS_FOR_CLASSIFICATION = 20
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üîó API d'Administration</h2>
                
                <h3>Gestion des Tournois</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /api/tournaments</div>
                    <div class="command-desc">Liste tous les tournois avec pagination et filtres</div>
                    <div class="params">
                        <div class="param"><span class="optional">page</span>: Num√©ro de page (d√©faut: 1)</div>
                        <div class="param"><span class="optional">limit</span>: Nombre par page (d√©faut: 20)</div>
                        <div class="param"><span class="optional">format</span>: Format MTG (modern, legacy, etc.)</div>
                        <div class="param"><span class="optional">date_from</span>: Date minimum (YYYY-MM-DD)</div>
                        <div class="param"><span class="optional">date_to</span>: Date maximum (YYYY-MM-DD)</div>
                    </div>
                    <div class="command-example">
curl "http://localhost:8000/api/tournaments?page=1&limit=10&format=modern"
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-post">POST</span> /api/tournaments</div>
                    <div class="command-desc">Cr√©er un nouveau tournoi</div>
                    <div class="params">
                        <div class="param"><span class="required">name</span>: Nom du tournoi</div>
                        <div class="param"><span class="required">format</span>: Format MTG</div>
                        <div class="param"><span class="optional">date</span>: Date du tournoi</div>
                        <div class="param"><span class="optional">location</span>: Lieu du tournoi</div>
                        <div class="param"><span class="optional">melee_id</span>: ID Melee.gg</div>
                    </div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/tournaments" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "GP Paris 2024",
    "format": "modern",
    "date": "2024-07-15",
    "location": "Paris, France"
  }'
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-put">PUT</span> /api/tournaments/{id}</div>
                    <div class="command-desc">Mettre √† jour un tournoi existant</div>
                    <div class="command-example">
curl -X PUT "http://localhost:8000/api/tournaments/123" \
  -H "Content-Type: application/json" \
  -d '{"name": "GP Paris 2024 - Updated"}'
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-delete">DELETE</span> /api/tournaments/{id}</div>
                    <div class="command-desc">Supprimer un tournoi</div>
                    <div class="command-example">
curl -X DELETE "http://localhost:8000/api/tournaments/123"
                    </div>
                </div>

                <h3>Gestion des Arch√©types</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /api/archetypes</div>
                    <div class="command-desc">Liste tous les arch√©types avec statistiques</div>
                    <div class="params">
                        <div class="param"><span class="optional">format</span>: Format MTG</div>
                        <div class="param"><span class="optional">min_decks</span>: Nombre minimum de decks</div>
                        <div class="param"><span class="optional">sort_by</span>: Tri (popularity, winrate, name)</div>
                    </div>
                    <div class="command-example">
curl "http://localhost:8000/api/archetypes?format=modern&sort_by=popularity"
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-post">POST</span> /api/archetypes</div>
                    <div class="command-desc">Cr√©er un nouvel arch√©type</div>
                    <div class="params">
                        <div class="param"><span class="required">name</span>: Nom de l'arch√©type</div>
                        <div class="param"><span class="required">format</span>: Format MTG</div>
                        <div class="param"><span class="optional">description</span>: Description</div>
                        <div class="param"><span class="optional">key_cards</span>: Cartes cl√©s (array)</div>
                        <div class="param"><span class="optional">color_identity</span>: Identit√© colorielle</div>
                    </div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/archetypes" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Burn",
    "format": "modern",
    "description": "Aggressive red deck",
    "key_cards": ["Lightning Bolt", "Lava Spike"],
    "color_identity": ["R"]
  }'
                    </div>
                </div>

                <h3>Gestion du Cache</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /api/cache/stats</div>
                    <div class="command-desc">Statistiques du cache</div>
                    <div class="command-example">
curl "http://localhost:8000/api/cache/stats"
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-post">POST</span> /api/cache/clear</div>
                    <div class="command-desc">Vider le cache</div>
                    <div class="params">
                        <div class="param"><span class="optional">keys</span>: Cl√©s sp√©cifiques √† supprimer</div>
                        <div class="param"><span class="optional">pattern</span>: Pattern de cl√©s √† supprimer</div>
                    </div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/cache/clear" \
  -H "Content-Type: application/json" \
  -d '{"pattern": "tournaments:*"}'
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-post">POST</span> /api/cache/refresh</div>
                    <div class="command-desc">Actualiser le cache</div>
                    <div class="params">
                        <div class="param"><span class="optional">force</span>: Forcer l'actualisation</div>
                        <div class="param"><span class="optional">source</span>: Source de donn√©es (melee, mtgtop8, mtgo)</div>
                    </div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/cache/refresh" \
  -H "Content-Type: application/json" \
  -d '{"source": "melee", "force": true}'
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìä Monitoring et Sant√©</h2>
                
                <h3>Endpoints de Surveillance</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /health</div>
                    <div class="command-desc">Sant√© basique de l'application</div>
                    <div class="command-example">
curl "http://localhost:8000/health"
# R√©ponse: {"status": "healthy", "timestamp": "2024-01-01T12:00:00Z"}
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /health/detailed</div>
                    <div class="command-desc">Diagnostic complet avec services externes</div>
                    <div class="command-example">
curl "http://localhost:8000/health/detailed"
# Inclut: database, cache, external_apis, system_metrics
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /metrics</div>
                    <div class="command-desc">M√©triques Prometheus</div>
                    <div class="command-example">
curl "http://localhost:8000/metrics"
# Format Prometheus pour Grafana
                    </div>
                </div>

                <h3>Alertes et Seuils</h3>
                <div class="config-section">
                    <div class="config-title">Configuration d'Alertes</div>
                    <table>
                        <tr>
                            <th>M√©trique</th>
                            <th>Seuil Warning</th>
                            <th>Seuil Critical</th>
                            <th>Action</th>
                        </tr>
                        <tr>
                            <td>CPU Usage</td>
                            <td>75%</td>
                            <td>90%</td>
                            <td>Notification + Scale</td>
                        </tr>
                        <tr>
                            <td>Memory Usage</td>
                            <td>80%</td>
                            <td>95%</td>
                            <td>Notification + Restart</td>
                        </tr>
                        <tr>
                            <td>Disk Usage</td>
                            <td>85%</td>
                            <td>95%</td>
                            <td>Notification + Cleanup</td>
                        </tr>
                        <tr>
                            <td>API Response Time</td>
                            <td>2s</td>
                            <td>5s</td>
                            <td>Notification</td>
                        </tr>
                        <tr>
                            <td>Error Rate</td>
                            <td>5%</td>
                            <td>10%</td>
                            <td>Notification + Investigation</td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="section">
                <h2>üîê S√©curit√© et Authentification</h2>
                
                <h3>Configuration de S√©curit√©</h3>
                <div class="config-section">
                    <div class="config-title">Param√®tres de S√©curit√©</div>
                    <div class="command-example">
# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=100
RATE_LIMIT_WINDOW=60

# CORS Configuration
CORS_ORIGINS=["http://localhost:3000", "https://metalyzr.com"]
CORS_METHODS=["GET", "POST", "PUT", "DELETE"]
CORS_HEADERS=["Content-Type", "Authorization"]

# API Key Authentication
API_KEY_REQUIRED=false
API_KEY_HEADER=X-API-Key
ADMIN_API_KEY=your-admin-key

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_ENABLED=true
CSP_ENABLED=true
                    </div>
                </div>

                <h3>Gestion des Acc√®s</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /api/admin/users</div>
                    <div class="command-desc">Liste des utilisateurs (n√©cessite API key admin)</div>
                    <div class="command-example">
curl "http://localhost:8000/api/admin/users" \
  -H "X-API-Key: your-admin-key"
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-post">POST</span> /api/admin/users/{id}/permissions</div>
                    <div class="command-desc">Modifier les permissions d'un utilisateur</div>
                    <div class="params">
                        <div class="param"><span class="required">permissions</span>: Array des permissions</div>
                    </div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/admin/users/123/permissions" \
  -H "X-API-Key: your-admin-key" \
  -H "Content-Type: application/json" \
  -d '{"permissions": ["read", "write", "admin"]}'
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìà Maintenance et Optimisation</h2>
                
                <h3>T√¢ches de Maintenance</h3>
                <div class="command">
                    <div class="command-title">Nettoyage de Base de Donn√©es</div>
                    <div class="command-desc">Nettoyer les donn√©es obsol√®tes</div>
                    <div class="command-example">
# Supprimer les tournois de plus de 2 ans
curl -X POST "http://localhost:8000/api/admin/cleanup" \
  -H "Content-Type: application/json" \
  -d '{"type": "tournaments", "older_than": "2y"}'

# Nettoyer les logs anciens
curl -X POST "http://localhost:8000/api/admin/cleanup" \
  -H "Content-Type: application/json" \
  -d '{"type": "logs", "older_than": "30d"}'
                    </div>
                </div>

                <div class="command">
                    <div class="command-title">Optimisation des Index</div>
                    <div class="command-desc">Optimiser les performances de base de donn√©es</div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/admin/optimize" \
  -H "Content-Type: application/json" \
  -d '{"type": "indexes"}'
                    </div>
                </div>

                <div class="command">
                    <div class="command-title">Analyse des Performances</div>
                    <div class="command-desc">G√©n√©rer un rapport de performance</div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/admin/analyze" \
  -H "Content-Type: application/json" \
  -d '{"type": "performance", "period": "7d"}'
                    </div>
                </div>

                <h3>Sauvegarde et Restauration</h3>
                <div class="command">
                    <div class="command-title">Sauvegarde Compl√®te</div>
                    <div class="command-desc">Cr√©er une sauvegarde compl√®te</div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/admin/backup" \
  -H "Content-Type: application/json" \
  -d '{"type": "full", "destination": "s3://backups/metalyzr"}'
                    </div>
                </div>

                <div class="command">
                    <div class="command-title">Restauration</div>
                    <div class="command-desc">Restaurer depuis une sauvegarde</div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/admin/restore" \
  -H "Content-Type: application/json" \
  -d '{"source": "s3://backups/metalyzr/backup-2024-01-01.sql"}'
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üõ†Ô∏è Outils de D√©veloppement</h2>
                
                <h3>API de Test</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /api/dev/test-data</div>
                    <div class="command-desc">G√©n√©rer des donn√©es de test</div>
                    <div class="params">
                        <div class="param"><span class="optional">count</span>: Nombre d'√©l√©ments √† g√©n√©rer</div>
                        <div class="param"><span class="optional">type</span>: Type de donn√©es (tournaments, decks, etc.)</div>
                    </div>
                    <div class="command-example">
curl "http://localhost:8000/api/dev/test-data?type=tournaments&count=10"
                    </div>
                </div>

                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-post">POST</span> /api/dev/reset-db</div>
                    <div class="command-desc">R√©initialiser la base de donn√©es (dev only)</div>
                    <div class="command-example">
curl -X POST "http://localhost:8000/api/dev/reset-db"
                    </div>
                </div>

                <h3>Debugging et Logs</h3>
                <div class="endpoint">
                    <div class="endpoint-method"><span class="badge badge-get">GET</span> /api/dev/logs</div>
                    <div class="command-desc">Consulter les logs en temps r√©el</div>
                    <div class="params">
                        <div class="param"><span class="optional">level</span>: Niveau de log (DEBUG, INFO, WARNING, ERROR)</div>
                        <div class="param"><span class="optional">limit</span>: Nombre de lignes</div>
                        <div class="param"><span class="optional">follow</span>: Suivre en temps r√©el</div>
                    </div>
                    <div class="command-example">
curl "http://localhost:8000/api/dev/logs?level=ERROR&limit=100"
                    </div>
                </div>
            </div>

            <div class="section">
                <h2>üìã Checklist d'Administration</h2>
                
                <h3>V√©rifications Quotidiennes</h3>
                <div class="step">
                    <strong>‚ñ° Status de sant√©</strong> - V√©rifier /health/detailed
                </div>
                <div class="step">
                    <strong>‚ñ° M√©triques syst√®me</strong> - CPU, RAM, disque < 80%
                </div>
                <div class="step">
                    <strong>‚ñ° Logs d'erreur</strong> - Aucune erreur critique
                </div>
                <div class="step">
                    <strong>‚ñ° Services externes</strong> - Melee.gg, MTGTop8 accessibles
                </div>
                <div class="step">
                    <strong>‚ñ° Cache</strong> - Taux de hit > 80%
                </div>

                <h3>V√©rifications Hebdomadaires</h3>
                <div class="step">
                    <strong>‚ñ° Sauvegarde</strong> - Cr√©er et v√©rifier sauvegarde
                </div>
                <div class="step">
                    <strong>‚ñ° Mises √† jour</strong> - D√©pendances et s√©curit√©
                </div>
                <div class="step">
                    <strong>‚ñ° Performance</strong> - Analyser les temps de r√©ponse
                </div>
                <div class="step">
                    <strong>‚ñ° Nettoyage</strong> - Supprimer donn√©es obsol√®tes
                </div>

                <h3>V√©rifications Mensuelles</h3>
                <div class="step">
                    <strong>‚ñ° Audit de s√©curit√©</strong> - V√©rifier logs d'acc√®s
                </div>
                <div class="step">
                    <strong>‚ñ° Optimisation BDD</strong> - R√©indexer si n√©cessaire
                </div>
                <div class="step">
                    <strong>‚ñ° Monitoring</strong> - Ajuster seuils d'alerte
                </div>
                <div class="step">
                    <strong>‚ñ° Documentation</strong> - Mettre √† jour proc√©dures
                </div>
            </div>

            <div class="success">
                <strong>‚úÖ Administration Ma√Ætris√©e !</strong><br>
                Vous avez maintenant tous les outils pour administrer Metalyzr de mani√®re professionnelle. R√©f√©rez-vous √† ce guide pour toutes les op√©rations avanc√©es.
            </div>
        </div>
    </div>
</body>
</html> 